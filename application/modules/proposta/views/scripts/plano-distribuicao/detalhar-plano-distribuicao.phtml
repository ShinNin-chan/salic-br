<?php $frmplanoHref = $this->url(array('module' => 'proposta' , 'controller' => 'plano-distribuicao', 'action' => 'frm-plano-distribuicao')).'?idPreProjeto='.$_GET['idPreProjeto']; ?>
<div class="container-fluid">
    <div class="row">
        <?php echo $this->partial("inc/menu.phtml", $this); ?>
        <div class="content col s10 m12 l10 planilha-produtos">
           <div class="row">
               <div class="col s12" id="example">
                    <?php
                    gerarBreadCrumb(array(
                        $this->layout['listagem'],
                        array('Plano de Distribui&ccedil;&atilde;o' => '')
                    )); ?>
                <?php $totalExemplares=0; $totalReceita=0; ?>
                    <?php foreach($this->planosDistribuicao as $planoDistribuicao) : ?>
                        <?php
                        $totalExemplares += $planoDistribuicao->QtdeProduzida;
                        $receita = ($planoDistribuicao->QtdeVendaNormal*$planoDistribuicao->PrecoUnitarioNormal)+($planoDistribuicao->QtdeVendaPromocional*$planoDistribuicao->PrecoUnitarioPromocional);
                        $totalReceita += $receita;
                        ?>
                            <div class=" responsive-table col s12 ">
                               <div class="row">
                                <table class="  bordered">
                                    <thead>
                                        <tr class="">
                                            <th>Nome do Evento / Produto</th>
                                            <th>&Aacute;rea</th>
                                            <th>Segmento</th>
                                            <th>Principal</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td ><?php echo $planoDistribuicao->Produto; ?></td>
                                            <td ><?php echo $planoDistribuicao->DescricaoArea; ?></td>
                                            <td ><?php echo $planoDistribuicao->DescricaoSegmento; ?></td>
                                            <td ><?php echo ($planoDistribuicao->stPrincipal == 0) ? 'N&atilde;o' : 'Sim'; ?></td>
                                        </tr>
                                        <tr>
                                            <td colspan="4">
                                                <?php foreach($this->abrangencias as $abrangencia): ?>
                                                <div class=" col s12 ">
                                                   <div class="row">
                                                <table class="  bordered">
                                                    <tbody>
                                                            <tr>
                                                                <td><?php echo $abrangencia['uf']?> - <?php echo $abrangencia['cidade']?></td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <my-component
                                                                        idplanodistribuicao="<?php echo $planoDistribuicao->idPlanoDistribuicao; ?>"
                                                                        idpreprojeto="<?php echo $this->idPreProjeto; ?>"
                                                                        iduf="<?php echo $abrangencia['idUF']?>"
                                                                        idmunicipioibge="<?php echo $abrangencia['idMunicipioIBGE']?>"
                                                                    ></my-component>
                                                                </td>
                                                            </tr>
                                                    </tbody>
                                                </table>
                                                    </div>
                                                </div>
                                                <?php endforeach; ?>
                                            <td>
                                        </tr>
                                    <tbody>
                                </table>
                            </div>
                        </div>
                    <?php endforeach ?>
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.4/numeral.min.js"></script>
<script src="https://unpkg.com/vue/dist/vue.js"></script>
<script type="text/x-template" id="app-6">
    <div>
    <div class="row">
        <div class="col s12 center">
            <table  class="bordered">
                <thead>
                    <tr>
                        <th rowspan="2">Categoria</th>
                        <th rowspan="2">Quantidade de exemplar / Ingresso</th>
                        <th class="center green lighten-4" colspan="3">
                            Distribui&ccedil;&atilde;o Gratuita
                        </th>
                        <th class="center red lighten-4"colspan="5">
                            Pre&ccedil;o Popular
                        </th>
                        <th  class="center lime lighten-3" colspan="5">
                            Proponente
                        </th>
                        <th rowspan="2">Receita Prevista</th>
                        <th rowspan="2">A&ccedil;&otildees</th>
                    </tr>
                    <tr>
                        <th class="green lighten-4" >Divulga&ccedil;&atilde;o</th>
                        <th class="green lighten-4" >Patrocinador</th>
                        <th class="green lighten-4" >Popula&ccedil;&atilde;o</th>
                        <th class="red lighten-4">Quantidade de Inteira</th>
                        <th class="red lighten-4">Quantidade de Meia Entrada</th>
                        <th class="red lighten-4">Pre&ccedil;o Unitario do Ingresso</th>
                        <th class="red lighten-4">Valor da inteira</th>
                        <th class="red lighten-4">Valor da meia entrada</th>
                        <th class="lime lighten-3" >Quantidade de Inteira</th>
                        <th class="lime lighten-3" >Quantidade de Meia Inteira</th>
                        <th class="lime lighten-3" >Pre&ccedil;o Unitario do Ingresso</th>
                        <th class="lime lighten-3" >Valor da inteira</th>
                        <th class="lime lighten-3" >Valor da meia entrada</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="( produto, index ) in produtos">
                        <td>{{ produto.dsProduto }}</td>
                        <td>{{ produto.qtExemplares }}</td>
                        <td>{{ produto.qtGratuitaDivulgacao }}</td>
                        <td>{{ produto.qtGratuitaPatrocinador }}</td>
                        <td>{{ produto.qtGratuitaPopulacao }}</td>
                        <td>{{ produto.qtPopularIntegral }}</td>
                        <td>{{ produto.qtPopularParcial }}</td>
                        <td>{{ produto.vlUnitarioPopularIntegral }}</td>
                        <td>{{ produto.vlReceitaPopularIntegral }}</td>
                        <td>{{ produto.vlReceitaPopularParcial }}</td>
                        <td>{{ produto.qtProponenteIntegral }}</td>
                        <td>{{ produto.qtProponenteParcial }}</td>
                        <td>{{ produto.vlUnitarioProponenteIntegral }}</td>
                        <td>{{ produto.vlReceitaProponenteIntegral }}</td>
                        <td>{{ produto.vlReceitaProponenteParcial }}</td>
                        <td>{{ produto.vlReceitaPrevista }}</td>
                        <td><button class="btn red white-text" v-on:click="excluir(produto.idDetalhamentoPlanoDistribuicaoProduto)"><i class="material-icons">delete</i></button></td>
                    </tr>
                </tbody>
                <tfoot class=" grey lighten-1">
                    <tr >
                        <td>Totais</td>
                        <td>{{ quantidadeTotal }}</td>
                        <td>{{ divulgacaoTotal }}</td>
                        <td>{{ populacaoTotal }}</td>
                        <td>{{ patrocinadorTotal }}</td>
                        <td>{{ inteiraTotal }}</td>
                        <td>{{ meiaEntradaTotal }}</td>
                        <td></td>
                        <td>{{ valorInteiraTotal }}</td>
                        <td>{{ valorMeiaEntradaTotal }}</td>
                        <td>{{ quantidadeInteiraTotal }}</td>
                        <td>{{ quantidadeMeiaEntradaTotal }}</td>
                        <td></td>
                        <td>{{ valorInteiraProponenteTotal }}</td>
                        <td>{{ valorMeiaEntradaProponenteTotal }}</td>
                        <td>{{ receitaPrevistaTotal }}</td>
                    </tr>
                </tfoot>
            </table>
       </div>
    </div>
    <div class="row">
        <div class="col s12 center">
           <button class="btn" v-on:click.prevent="mostrar()"><i class="material-icons">{{icon}}</i></button>
       </div>
    </div>
           <div v-show="active">
                <form>
                        <table class="bordered " >
                            <thead>
                                <tr>
                                    <th></th>
                                    <th></th>
                                    <th class="center" colspan="8">At&eacute; 50%</th>
                                    <th class="center" colspan="5">At&eacute; 50%</th>
                                </tr>
                                <tr>
                                    <th rowspan="2">Categoria</th>
                                    <th rowspan="2">Quantidade de exemplar / Ingresso</th>
                                    <th class="center green lighten-4" colspan="3">
                                        Distribui&ccedil;&atilde;o Gratuita (no minimo 30%)
                                    </th>
                                    <th class="center red lighten-4"colspan="5">
                                        Pre&ccedil;o Popular (at&eacute; 20%)
                                    </th>
                                    <th  class="center lime lighten-3" colspan="5">
                                        Proponente
                                    </th>
                                    <th rowspan="2">Receita Prevista</th>
                                    <th rowspan="2">A&ccedil;&otildees</th>
                                </tr>
                                <tr>
                                    <th class="green lighten-4" >Divulga&ccedil;&atilde;o</th>
                                    <th class="green lighten-4" >Patrocinador</th>
                                    <th class="green lighten-4" >Popula&ccedil;&atilde;o</th>
                                    <th class="red lighten-4">Quantidade de Inteira</th>
                                    <th class="red lighten-4">Quantidade de Meia Entrada</th>
                                    <th class="red lighten-4">Pre&ccedil;o Unitario do Ingresso</th>
                                    <th class="red lighten-4">Valor da inteira</th>
                                    <th class="red lighten-4">Valor da meia entrada</th>
                                    <th class="lime lighten-3" >Quantidade de Inteira</th>
                                    <th class="lime lighten-3" >Quantidade de Meia Inteira</th>
                                    <th class="lime lighten-3" >Pre&ccedil;o Unitario do Ingresso</th>
                                    <th class="lime lighten-3" >Valor da inteira</th>
                                    <th class="lime lighten-3" >Valor da meia entrada</th>
                                </tr>
                                <tr>
                                    <th class="green lighten-4" ></th>
                                    <th class="green lighten-4" ></th>
                                    <th class="green lighten-4" >At&eacute; {{ (qtExemplares * 0.1) }}</th>
                                    <th class="green lighten-4" >At&eacute; {{ (qtExemplares * 0.1) }}</th>
                                    <th class="green lighten-4" >de {{ (qtExemplares * 0.1) }} at&eacute; {{ (qtExemplares * 0.3) }}</th>
                                    <th class="green lighten-4" >At&eacute; {{ qtPrecoPopularValorIntegralLimite }}</th>
                                    <th class="green lighten-4" >At&eacute; {{ qtPrecoPopularValorParcialLimite }}</th>
                                    <th class="green lighten-4" >At&eacute; 50,00</th>
                                </tr>
                            </thead>
                            <tbody class=" green lighten-7">
                            <tr>
                                <td>
                                    <div class="input-field  ">
                                        <input  id="dsProduto" v-model="dsProduto">
                                    </div>
                                </td>
                                <td>
                                    <div class="input-field">
                                        <input  v-model.lazy="qtExemplares" >
                                    </div>
                                </td>
                                <td>
                                    <div class="input-field">
                                        <input v-model.number="qtGratuitaDivulgacao" >
                                    </div>
                                </td>
                                <td>
                                    <div class="input-field">
                                        <input v-model="qtGratuitaPatrocinador" ref="patrocinador">
                                    </div>
                                </td>
                                <td>
                                    <div class="input-field">
                                        <input v-model="qtGratuitaPopulacao"  v-on:blur="populacaoValidate(qtGratuitaPopulacao)">
                                    </div>
                                <td>
                                    <div class="input-field">
                                        <input v-model="qtPrecoPopularValorIntegral"  >
                                    </div>
                                </td>
                                <td>
                                    <div class="input-field">
                                        <input v-model="qtPrecoPopularValorParcial"  >
                                    </div>
                                </td>
                                <td>
                                    <div class="input-field ">
                                        <input-money
                                             v-bind:value="vlUnitarioPopularIntegral"
                                             v-on:ev="vlUnitarioPopularIntegral = $event">
                                        </input-money>
                                    </div>
                                </td>
                                <td>{{ vlReceitaPopularIntegral }}</td>
                                <td>{{ vlReceitaPopularParcial }}</td>
                                <td>{{ qtProponenteIntegral }}</td>
                                <td>{{ qtProponenteParcial }}</td>
                                <td>
                                    <div class="input-field ">
                                        <input-money
                                             v-bind:value="vlUnitarioProponenteIntegral"
                                             v-on:ev="vlUnitarioProponenteIntegral = $event">
                                        </input-money>
                                    </div>
                                </td>
                                <td>{{ vlReceitaProponenteIntegral }}</td>
                                <td>{{ vlReceitaProponenteParcial }}</td>
                                <td>{{ vlReceitaPrevista }}</td>
                                <td>
                                    <button class="btn" v-on:click.prevent="salvar"><i class="material-icons">add</i></button>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </form>
        </div>
    </div>
</script>
<script type="text/javascript" src="/public/scripts/proposta/plano-distribuicao/detalhar-plano-distribuicao.js"></script>

<link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link rel="stylesheet" href="<?php echo $this->baseUrl(); ?>/public/library/materialize/css/materialize.css">
<!--        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/css/materialize.min.css">-->
<link rel="stylesheet" href="<?php echo $this->baseUrl(); ?>/public/library/materialize/css/materialize-custom.css">
<link rel="stylesheet" href="<?php echo $this->baseUrl(); ?>/public/css/animate.css">
<script>
    $(document).ready(function(){

        <?php if(isset($this->movimentacaoAtual) && $this->movimentacaoAtual != '95'): ?>
        //DESABILITA ALTERACOES NOS DADOS DO FORMULARIO (INCLUIR/ALTERAR/EXCLUIR)
        JSBloquearAlteracaoFormulario();
        <?php endif; ?>
    });
</script>
<style>

    /*
    Verde claro: #81C784
Verde médio: #4CAF50
Verde escuro: #1B5E20
Rosa: #FF8A80
Azul: #039BE5
Laranja: #FB8C00
Amarelo: #FDD835
Cinza claro: #FAFAFA
Cinza médio: #EEEEEE
Cinza escuro: #212121
*/

    .btn,
    .btn-large,
    .btn-floating,
    .btn-default,
    .btn-success  {
        background: #4caf50;
    }

    .btn:focus,
    .btn-large:focus,
    .btn-floating:focus,
    .btn:hover,
    .btn-default:focus,
    .btn-sucess:focus,
    .btn-default:hover,
    .btn-success:hover {
        background: #388e3c;
    }

    .btn-primary {
        background-color: #29b6f6;
    }

    .btn-primary:focus,
    .btn-primary:hover {
        background: #0277bd;
    }

    .btn-danger {
        background: #FF8A80;
    }

    .btn-danger:focus,
    .btn-danger:hover {
        background: #ff5252;

    }

    .btn-warning {

    }

    .btn-success {

    }

    .bg_info {

    }

    #toast-container div {
        font-weight: bold;
    }

    #navglobal {
        /*background: #FAFAFA;*/
        box-shadow: 0px 4px 7px #cac5c5;;

    }

    header {
        margin-bottom: 0px;
        margin-bottom: -10px;
    }

    #breadcrumb {
        left: 0px;
    }

    #container-list {
        margin-top: 15px;
    }

    #space_menu {
        background: none;
        height: auto;
    }

    .menu-contexto {
        background: #eeeeee;
        border-right: 1px solid #D2D2D2;
        float: left;
        margin-left: -10px;
        width: 98%;
        height: 100%;
        min-height: 900px;
    }

    #menuContexto {
        background: none;
        width: 100%;
        left: auto;
    }

    #menuContexto #qm0 {
        width: 100%;
        padding: 5px 0px;
    }

    #menuContexto #qm0 a {
        background: none;
        border: none;
        padding: 10px 5px;
        margin: 0px 15px;
        font-size: 13px;
        font-family: "Roboto", sans-serif;
        width:88%;
        border-bottom: 1px solid #d2d2d2;
    }

    #menuContexto #qm0 a:hover {
        background: rgba(54, 150, 63, 0.72);
        color: #ffffff;
    }

    #menuContexto #qm0 a:last-child {
        border-bottom: none;
    }

    #menuContexto .top {
        background: none;
        height: 0;
    }

    #menuContexto .bottom {
        background: none;
        height: 0;
    }

    #qm0 .no_seta:hover {
        background: none;
    }

    .sidebar aside h3:after {
        content: "";
        display: block;
        position: absolute;
        bottom: -9px;
        left: 10px;
        width: 0;
        border-width: 9px 9px 0px 9px;
        border-style: solid;
        border-color: #0c451a transparent;
    }

    #rodapeConteudo_com_menu {
        display: none;
    }

    table th {
        font-size: 14px;
        padding: 16px;
        background: transparent;
        color: #212121;
        text-transform: none;
    }

    table td {
        padding: 16px;
        color: #212121;
    }

    table td.action {
        padding-left: 5px;
        padding-right: 5px;
    }

    .collapsible table td {
        padding-top: 7px;
        padding-bottom: 7px;
    }
    .collapsible {
        box-shadow: none;
        border-right: none;
        border-left: none;
    }
    .collapsible-header {
        padding: 8px;
    }

    .collapsible .collapsible .collapsible-header {
        padding-left: 40px;
    }

    table .left-align {
        text-align: left !important;
    }

    table .right-align {
        text-align: right !important;
    }

    table thead tr.title {
        background: transparent;
    }

    table thead tr.title th {
        text-transform: uppercase;
        text-align: left;
        font-size: 17px;
        /*color: #fff;*/
    }

    .tabs .tab a {
        background: #fff;
        color: #212121;
    }

    .tabs .tab a:hover,
    .tabs .tab a.active {
        background-color: #c8e6c9;
        color: #212121;
    }

    .tabs .indicator {
        background-color: #4caf50;
        right: 1155.38px;
        left: 0px;
        width: 25%;
    }

    form .input_simples:hover,
    form .textarea_simples:hover,
    form .select_simples:hover,
    form .input_simples2:hover,
    form .input_simples,
    form .textarea_simples,
    form .select_simples,
    form .input_simples2 {
        background: none;
    }

    form select.browser-default {
        min-height: 44px;
        background-color: #fafafa;
        border: 1px solid #212121;
        width: 100%;

    }

    form textarea.materialize-textarea {
        margin-top: 10px;
        padding: 13px 10px;
        border: 1px solid #212121; !important;
    }

    .input-field label,
    form label {
        color: #212121;
    }

    .modal.bottom-sheet {
        max-height: 50%;
        /*overflow: visible;*/
    }

    .section {
        position: relative;
    }

    .section .btn-close-modal {
        position: absolute;
        top: 5px;
        z-index: 32;
        right: -76px;
    }
    .section  span.badge {
        font-size: 1.3rem;
    }


</style>

<div class="row">
    <div class="col s2 m12 l2">
        <div class="menu-contexto">
            <?php  echo $this->partial("manterpropostaincentivofiscal/inc/menu.inc.php", $this); ?>
        </div>
    </div>
    <div class="content col s10 m12 l10">
        <?php
            $controller = "manterorcamento";
            $links = array(
                array('Lista de Propostas' => array('controller' => 'manterpropostaincentivofiscal','action' => 'listar-propostas')),
                array('Or&ccedil;amento' => array())
            );
            montaGuiaLinks($controller, $links);
        ?>
        <div class="clearfix"></div>
        <h5 class="light">Custo por produto </h5>

        <div id="container-list" data-ajax-render='/proposta/manterorcamento/listarprodutos/idPreProjeto/<?php echo( isset($this->idPreProjeto) ) ? $this->idPreProjeto : ''; ?>'></div>

        <div id="custosvinculados" data-ajax-render='/proposta/manterorcamento/resumoplanilha/idPreProjeto/<?php echo( isset($this->idPreProjeto) ) ? $this->idPreProjeto : ''; ?>'></div>
    </div>
</div>


<!-- FIM DIV CONTEUDO -->
    <div id="msg"></div>

    <!-- ========== INCIO RODAPE DO CONTEDO ========== -->
    <div id="rodapeConteudo"><span></span></div>
    <!-- ========== FIM RODAPE DO CONTEDO ========== -->
    <br clear="all" />


<script>

$3(document).ready(function () {

    $3('body').on('click', '.btn-salvar', function () {

        var validar = true;
        $3('.valida').each(function () {
            if ($3(this).val() == '') {
                validar = false;
            }
        });

        if (validar == false) {
            Materialize.toast("Dados obrigat&oacute;rios n&atilde;o informados!", 4000);
            return false;
        } else {
            if ($3("#qtd").val() == 0) {
                Materialize.toast('Quantidade n&atilde;o pode ser igual a zero', 4000);
                $3("#qtd").focusin();
                return false;
            }

            if ($3("#ocorrencia").val() == 0) {
                Materialize.toast('Ocorr&ecirc;ncia n&atilde;o pode ser igual a zero', 4000);
                $3("#ocorrencia").focusin();
                return false;
            }

            var vlunitario = $3("#vlunitario").val();
            vlunitario = vlunitario.replace(/\D/g, "");
            vlunitario = vlunitario.replace(/(\d{0})(\d)/, "$1$2");

            if (vlunitario == 0) {
                Materialize.toast('Valor unit&aacute;rio n&atilde;o pode ser igual a zero', 4000);
                $3("#vlunitario").focusin();
                return false;
            }

            if ($3("#qtdDias").val() == 0) {
                Materialize.toast('Quantidade de dias n&atilde;o pode ser igual a zero', 4000);
                $3("#qtdDias").focusin();
                return false;
            }

            $3.post($3('#form').attr('action'), $3('#form').serialize(), function (result) {
                result = $3.parseJSON(result);
                if (result.status == '1') {
                    console.log(result.status + result.action);

                    if( result.action == 'update') {
                        $("#item-planilha-" +result.idPlanilhaProposta).replaceWith(result.html);
                    }
                    else if( result.action == 'insert') {

                        var produto = $3('#produto').val();
                        var etapa = $3('#idPlanilhaEtapa').val();
                        var mun = $3('#municipio').val();

                        var idEtapa = "#etapa" + etapa + "" + mun + "" + produto;

                        $3(idEtapa + " div.info").hide();
                        $3(idEtapa + ' table tbody').append(result.html);
                    }

                    if(result.close == '1' )
                        $3('#modal').modal('close');

                    $3('#form')[0].reset();
//                    $3.ajaxRender()
                    Materialize.toast(result.msg, 4000, 'green white-text');
                    $3.each($('div[data-ajax-render]'), function () {
                        $3.ajaxRender({
                            strUrl: $('#custosvinculados').attr('data-ajax-render'),
                            strTarget: '#custosvinculados'
                        });
                    });
                } else {
                    Materialize.toast(result.msg, 8000, 'red darken-1 white-text');
                }
            });
         }
         return false;
    });

});



//function excluirItem(idPlanilhaProposta) {
////        $(".btn-excluir-item").click(function () {
////            var idPlanilhaProposta = $(this).attr('data-ajax');
//
//    $("#msg").html('Tem certeza que deseja excluir o item?');
//
//    $("#msg").dialog
//    ({
//        width: 350,
//        height: 200,
//        modal: true,
//        draggable: false,
//        resizable: false,
//        closeOnEscape: false,
//        buttons: {
//            'N\xE3o': function () {
//                $(this).dialog('close');
//            },
//            'Sim': function () {
//                var urlAction = "<?php //echo $this->url(array('module' => 'proposta', 'controller' => 'manterorcamento', 'action' => 'excluiritem')); ?>//";
//                var dados = {idPlanilhaProposta: idPlanilhaProposta};
//
//                $.post(urlAction, dados, function (result) {
//                    result = JSON.parse(result);
//                    if (result.status == '1') {
//                        $("#item-planilha-" + idPlanilhaProposta).remove();
//                        Materialize.toast(result.msg, 4000, 'green white-text');
//                    } else {
//                        Materialize.toast(result.msg, 8000, 'red darken-1 white-text');
//                    }
//                });
//
//                $(this).dialog('close');
//            }
//        }
//    });
//
//    $(".ui-dialog-titlebar-close").remove();
//
//    return false;
//}


</script>
<div id="breadcrumb">
    <ul>
        <li class="first"><a
                href="<?php echo $this->url(array('module' => 'admissibilidade', 'controller' => 'gerenciarparecer', 'action' => 'index'), '', true); ?>"
                title="Ir para In&iacute;cio">In&iacute;cio</a></li>
        <li>
            <a href="<?php echo $this->url(array('module' => 'admissibilidade', 'controller' => 'gerenciarparecer', 'action' => 'listaprojetos'), '', true); ?>"
               title="Localizar Parecer">Gerenciar Pareceres</a></li>
    </ul>
</div>
<div id="titulo">
    <div>
        Gerenciar Enquadramentos
        <span class="voltar">
            <a href="#" onclick="voltar();">
                Voltar
            </a>
        </span>
    </div>
</div>
<div id="conteudo">
    <?php if ($this->qtdDocumentos != 0): ?>
        <table class="tabela gerenciar_pareceres">
            <tr class="titulo_tabela">
                <th width="40">PRONAC</th>
                <th>Nome do Projeto</th>
                <th>Segmento Cultural</th>
                <th>Vl.&nbsp;Incentivo<br/>(S&oacute; Mecenato)</th>
                <th width="250">Produto</th>
                <th width="80">Produto principal?</th>

                <?php if ($this->tipoFiltro == 'aguardando_distribuicao') { ?>
                <th width="80">Dt. Chegada &agrave; vinculada</th>
                <?php } else if ($this->tipoFiltro == 'em_analise' || $this->tipoFiltro == 'em_validacao') { ?>
                <th width="80">Dt. distribui&ccedil;&atilde;o</th>

                <?php if ($this->tipoFiltro == 'em_validacao') { ?>
                    <th width="80">Dt. devolu&ccedil;&atilde;o</th>
                <?php } ?>

                <th width="80">Parecerista</th>
                <th width="80">Tempo total de an&aacute;lise</th>
                <th width="80">Tempo com parecerista</th>
                <th width="80">Tempo diligenciado</th>

                <?php if ($this->tipoFiltro == 'em_analise') { ?>
                    <th width="80">Dt. envio dilig&ecirc;ncia</th>
                    <th width="80">Dt. resposta dilig&ecirc;ncia</th>
                <?php } ?>

                <?php } else if ($this->tipoFiltro == 'validados') { ?>
                    <th width="80">T&eacute;cnico validador</th>
                    <th width="80">Dt. valida&ccedil;&atilde;o</th>
                <?php } else if ($this->tipoFiltro == 'devolvida') { ?>
                    <th width="50">Justificativa do componente</th>
                    <th width="50">Justificativa do atendimento</th>
                    <th width="50">Justificativa da Secretaria</th>
                    <th width="50">Parecerista</th>
                <?php } ?>
                <th width="50">Distribuir / Encaminhar</th>
                <?php if ($this->tipoFiltro != 'aguardando_distribuicao' && $this->tipoFiltro != '') { ?>
                    <th width="50">Hist&oacute;rico</th>
                <?php } ?>
                <?php if ($this->tipoFiltro == 'validados' || $this->tipoFiltro == 'em_validacao' || $this->tipoFiltro == 'devolvida') { ?>
                    <th width="50">Concluir</th>
                <?php } ?>
            </tr>
            <?php
            $nomeProjeto = '';
            $pronac = '';
            $produto = '';
            $tipostatus = array('AN&Aacute;LISE CONCLU&Iacute;DA', 'Aguardando distribui&ccedil;&atilde;o');
            foreach ($this->dados as $dp):
                ?>
                <tr class="<?php if ($dp->FecharAnalise == 2) {
                    echo 'red';
                } ?>">
                    <td align="center">
                        <a target="_blank"
                           href="<?php echo $this->url(array('controller' => 'consultardadosprojeto', 'action' => 'index')); ?>?idPronac=<?php echo $dp->IdPRONAC; ?>"><?php if ($pronac != $dp->NrProjeto) echo $dp->NrProjeto; ?></a>
                    </td>
                    <td><?php if (($nomeProjeto != $dp->NomeProjeto) || ($pronac != $dp->NrProjeto)) echo $dp->NomeProjeto; ?></td>
                    <td><?php echo $dp->Segmento; ?></td>
                    <td align="right" nowrap><?php echo $this->formatarReal($dp->Valor); ?></td>
                    <td>
                        <a href="<?php echo $this->url(array('controller' => 'Analisarprojetoparecer', 'action' => 'produto')); ?>?idPronac=<?php echo $dp->IdPRONAC; ?>&idProduto=<?php echo $dp->idProduto; ?>&stPrincipal=<?php echo $dp->stPrincipal; ?>"><?php echo $dp->Produto; ?></a>
                    </td>
                    <td align="center">
                        <?php if ($dp->stPrincipal == 1) { ?><img title="Produto Principal"
                                                                  src="<?php echo $this->baseUrl(); ?>/public/img/passed.gif" /><?php } ?>
                    </td>

                    <?php if ($this->tipoFiltro == 'aguardando_distribuicao') { ?>
                        <td align="center"><?php echo Data::tratarDataZend($dp->DtEnvioMincVinculada, 'Brasileira'); ?></td>

                    <?php } else if ($this->tipoFiltro == 'em_analise' || $this->tipoFiltro == 'em_validacao') { ?>
                        <td align="center"><?php echo Data::tratarDataZend($dp->DtDistribuicao, 'Brasileira'); ?></td>
                        <?php if ($this->tipoFiltro == 'em_validacao') { ?>
                            <td align="center"><?php echo Data::tratarDataZend($dp->DtDevolucao, 'Brasileira'); ?></td>
                        <?php } ?>
                        <td align="center"><strong><?php echo $dp->Parecerista; ?></strong></td>
                        <td align="center"><?php echo $dp->TempoTotalAnalise; ?></td>
                        <td align="center"><?php echo $dp->TempoParecerista; ?></td>
                        <td align="center"><?php echo $dp->TempoDiligencia; ?></td>
                        <?php if ($this->tipoFiltro == 'em_analise') { ?>
                            <td align="center"><?php if ($dp->dtEnvioDiligencia != null) { ?><?php echo Data::tratarDataZend($dp->dtEnvioDiligencia, 'Brasileira'); ?><?php } ?></td>
                            <td align="center"><?php if ($dp->dtRespostaDiligencia != null) { ?><?php echo Data::tratarDataZend($dp->dtRespostaDiligencia, 'Brasileira'); ?><?php } ?></td>
                        <?php } ?>
                    <?php } else if ($this->tipoFiltro == 'validados') { ?>
                        <td align="center"><strong><?php echo $dp->TecnicoValidador; ?></strong></td>
                        <td align="center"><?php echo Data::tratarDataZend($dp->DtValidacao, 'Brasileira'); ?></td>
                    <?php } else if ($this->tipoFiltro == 'devolvida') { ?>
                        <td align="center">
                            <?php if ($dp->JustComponente != '') { ?>
                                <a title="<?php echo strip_tags($dp->JustComponente); ?>" class="tooltip"
                                   style="text-decoration: none; cursor: pointer">
                                    <span title=" "><?php echo substr($dp->JustComponente, 0, 50); ?>...</span>
                                </a>
                            <?php } ?>
                        </td>
                        <td align="center">
                            <?php if ($dp->JustDevolucaoPedido != '') { ?>
                                <a title="<?php echo strip_tags($dp->JustDevolucaoPedido); ?>" class="tooltip"
                                   style="text-decoration: none; cursor: pointer">
                                    <span title=" "><?php echo substr($dp->JustDevolucaoPedido, 0, 50); ?>...</span>
                                </a>
                            <?php } ?>
                        </td>
                        <td align="center">
                            <?php if ($dp->JustSecretaria != '') { ?>
                                <a title="<?php echo strip_tags($dp->JustSecretaria); ?>" class="tooltip"
                                   style="text-decoration: none; cursor: pointer">
                                    <span title=" "><?php echo substr($dp->JustSecretaria, 0, 50); ?>...</span>
                                </a>
                            <?php } ?>
                        </td>
                        <td align="center"><strong><?php echo $dp->Parecerista; ?></strong></td>
                    <?php } ?>
                    <td align="center">
                        <?php if ($dp->stPrincipal == 1) { ?>
                            <img id="img_distribuir_parecer<?php echo $dp->idDistribuirParecer; ?>"
                                 style="cursor:pointer; " title="Distribuir Projeto"
                                 src="<?php echo $this->baseUrl() . '/public/img/ico/archive.png'; ?>"
                                 onclick="redirecionar('<?php echo $this->url(array('controller' => 'gerenciarparecer', 'action' => 'distribuir', 'idpronac' => $dp->IdPRONAC)); ?>/tipoFiltro/<?php echo $this->tipoFiltro; ?>')"/>
                        <?php } ?>
                        <img id="img_encaminhar_parecer<?php echo $dp->idDistribuirParecer; ?>" style="cursor:pointer; "
                             title="Distribuir Produtos"
                             src="<?php echo $this->baseUrl() . '/public/img/table_multiple.png'; ?>"
                             onclick="redirecionar('<?php echo $this->url(array('controller' => 'gerenciarparecer', 'action' => 'encaminhar', 'idpronac' => $dp->IdPRONAC, 'idproduto' => $dp->idProduto)); ?>/tipoFiltro/<?php echo $this->tipoFiltro; ?>')"/>
                    </td>
                    <?php if ($this->tipoFiltro != 'aguardando_distribuicao' && $this->tipoFiltro != '') { ?>
                    <td align="center"><img style="cursor:pointer;" title="Hist&oacute;rico"
                                            src="<?php echo $this->baseUrl(); ?>/public/img/edit_ico.gif"
                                            onclick="redirecionar('<?php echo $this->url(array('controller' => 'gerenciarparecer', 'action' => 'historico')); ?>?idPronac=<?php echo $dp->IdPRONAC; ?>&idProduto=<?php echo $dp->idProduto; ?>&stPrincipal=<?php echo $dp->stPrincipal; ?>&tipoFiltro=<?php echo $this->tipoFiltro; ?>')">
                        <?php } ?>
                        <?php if ($this->tipoFiltro == 'validados' || $this->tipoFiltro == 'em_validacao' || $this->tipoFiltro == 'devolvida') { ?>
                    <td align="center">
                        <?php if ($dp->stPrincipal == 1) { ?>
                            <?php if ($this->checarValidacaoSecundarios[$dp->IdPRONAC] == 1) { ?>
                                <img id="img_concluir_analise<?php echo $dp->idDistribuirParecer; ?>"
                                     style="cursor:pointer;" title="Concluir"
                                     src="<?php echo $this->baseUrl() . '/public/img/save.gif'; ?>"
                                     onclick="redirecionar('<?php echo $this->url(array('controller' => 'gerenciarparecer', 'action' => 'concluir', 'idDistribuirParecer' => $dp->idDistribuirParecer, 'idpronac' => $dp->IdPRONAC)); ?>/tipoFiltro/<?php echo $this->tipoFiltro; ?>')">
                            <?php } ?>
                        <?php } else { ?>
                            <img id="img_concluir_analise<?php echo $dp->idDistribuirParecer; ?>"
                                 style="cursor:pointer;" title="Concluir"
                                 src="<?php echo $this->baseUrl() . '/public/img/save.gif'; ?>"
                                 onclick="redirecionar('<?php echo $this->url(array('controller' => 'gerenciarparecer', 'action' => 'concluir', 'idDistribuirParecer' => $dp->idDistribuirParecer, 'idpronac' => $dp->IdPRONAC)); ?>/tipoFiltro/<?php echo $this->tipoFiltro; ?>')">
                        <?php } ?>
                    </td>
                <?php } ?>

                </tr>
                <?php
                $nomeProjeto = $dp->NomeProjeto;
                $pronac = $dp->NrProjeto;
                $produto = $dp->Produto;
                ?>
            <?php endforeach; ?>
        </table>

        <?php if (count($this->dados) > 0): ?>
            <center>
                <?php
                echo $this->paginacao['inicio'] . " a ";
                echo ($this->paginacao['pag'] - 1) * $this->paginacao['Itenspag'] + $this->paginacao['tamanho'];
                echo " de " . $this->paginacao['total'];
                ?>
            </center>
            <table class="tabela" style="width: 97%;" border="0" cellpadding="0" cellspacing="0">
                <tbody>
                <tr>
                    <td align="center">
                        <form name="form2" id="form2"
                              action="<?php echo $this->url(array('controller' => 'gerenciarparecer', 'action' => 'listaprojetos')); ?>"
                              method="get">
                            <?php if ($this->paginacao['pag'] > 1) { ?>
                                <input class="btn_inicio" id="btn_inicio" type="button" class="btn_inicio"
                                       onclick="location.href='<?php echo $this->url(array('controller' => 'gerenciarparecer', 'action' => 'listaprojetos')) . '?pag=1' . "&qtde=" . $this->paginacao['qtde'] . $this->paginacao['ordenacao'] . '&pronac=' . $this->pronacProjeto . '&tipoFiltro=' . $this->tipoFiltro; ?>'">
                            <?php } ?>
                            <input id="btn_p_anterior" type="button"
                                <?php if ($this->paginacao['pag'] <= 1) { ?> class="btn_p_anterior-off"
                                <?php } else { ?>
                                    class="btn_p_anterior"
                                    onclick="location.href='<?php echo $this->url(array('controller' => 'gerenciarparecer', 'action' => 'listaprojetos')) . '?pag=' . ($this->paginacao['pag'] - 1) . "&qtde=" . $this->paginacao['qtde'] . $this->paginacao['ordenacao'] . '&pronac=' . $this->pronacProjeto . '&tipoFiltro=' . $this->tipoFiltro; ?>'"
                                <?php } ?>>
                            <input id="btn_p_proximo" type="button"
                                <?php if ($this->paginacao['pag'] + 1 > $this->paginacao['totalPag']) { ?>
                                    class="btn_p_proximo-off"
                                <?php } else { ?>
                                    class="btn_p_proximo"
                                    onclick="location.href='<?php echo $this->url(array('controller' => 'gerenciarparecer', 'action' => 'listaprojetos')) . '?pag=' . ($this->paginacao['pag'] + 1) . "&qtde=" . $this->paginacao['qtde'] . $this->paginacao['ordenacao'] . '&pronac=' . $this->pronacProjeto . '&tipoFiltro=' . $this->tipoFiltro; ?>'"
                                <?php } ?>>
                            <?php if ($this->paginacao['pag'] < $this->paginacao['totalPag']) { ?>
                                <input class="btn_ultimo" id="btn_ultimo" type="button"
                                       onclick="location.href='<?php echo $this->url(array('controller' => 'gerenciarparecer', 'action' => 'listaprojetos')) . '?pag=' . ($this->paginacao['totalPag']) . "&qtde=" . $this->paginacao['qtde'] . $this->paginacao['ordenacao'] . '&pronac=' . $this->pronacProjeto . '&tipoFiltro=' . $this->tipoFiltro; ?>'">
                            <?php } ?>
                            P&aacute;g.:<select name="pag" id="pag" onchange="$('#form2').submit()"
                                                class="input_simples">
                                <?php for ($i = 1; $i <= $this->paginacao['totalPag']; $i++): ?>
                                    <option
                                        value="<?php echo $i; ?>" <?php if ($this->paginacao['pag'] == $i) echo "selected"; ?>><?php echo $i; ?>
                                        &nbsp;</option>
                                <?php endfor; ?>
                            </select>
                            &nbsp;Registros por p&aacute;gina: <input type="text" size="1" name="qtde" id="qtde"
                                                                      class="input_simples"
                                                                      value="<?php echo $this->intTamPag; ?>"><input
                                type="submit" class="btn_recarregar" value="">
                            <input type="hidden" name="campo" value="<?php echo $this->paginacao['campo']; ?>">
                            <input type="hidden" name="ordem" value="<?php echo $this->paginacao['ordem']; ?>">
                            <input type="hidden" name="tipoFiltro" value="<?php echo $this->tipoFiltro; ?>">
                            <input type="hidden" name="pronac" value="<?php echo $this->pronacProjeto; ?>">
                        </form>
                    </td>
                </tr>
                </tbody>
            </table>
        <?php endif; ?>
    <?php endif; ?>
    <br clear="all"/>
</div>
<div id="rodapeConteudo"><span></span></div>
<br clear="all"/>
<script type="text/javascript">

    $(document).ready(function () {
        $('#pinicial').click(function () {
            $('#analiseinicial').toggle('slow');
        });

        $('#preadequacao').click(function () {
            $('#readequacao').toggle('slow');
        });

        $("#pronac").keypress(function (e) {
            if (e.which == 13) {
                var pronac = $('#pronac').val(),
                    filtro = $('.comboFiltro').val();
                window.location = "<?php echo $this->url(array('controller' => 'gerenciarparecer', 'action' => 'listaprojetos')); ?>?pag=1&tipoFiltro=" + filtro + "&pronac=" + pronac;
            }
        });

        $("#btn_pesquisar").click(function () {
            var pronac = $('#pronac').val(),
                filtro = $('.comboFiltro').val();
            window.location = "<?php echo $this->url(array('controller' => 'gerenciarparecer', 'action' => 'listaprojetos')); ?>?pag=1&tipoFiltro=" + filtro + "&pronac=" + pronac;
        });

        $('.comboFiltro').change(function () {
            window.location = "<?php echo $this->url(array('controller' => 'gerenciarparecer', 'action' => 'listaprojetos')); ?>?tipoFiltro=" + $(this).val();
        });
    });
</script>

<div class="modal-content">
    <h4><?php echo $this->title; ?></h4>
    <form id="form-mensagem" action="<?php echo $this->url(array('module' => 'admissibilidade', 'controller' => 'mensagem', 'action' => $this->action)); ?>">
        <input name="idMensagemProjeto" type="hidden" value="<?php echo $this->id; ?>"/>
        <input name="IdPRONAC" type="hidden" value="<?php echo $this->idPronac; ?>"/>
        <div class="row">
            <div class="input-field col s12">
                <select class="invalid"  data-ajax-render="/admissibilidade/mensagem/usuarios" data-ajax-target="select[name=idDestinatario]" name="idUnidade" <?php if (isset($this->arrConfig['idDestinatario']) && $this->arrConfig['idDestinatario']['disabled']) echo 'disabled="disabled"' ?>>
                    <option value="" disabled selected>Selecione...</option>
<!--                        <optgroup label="--><?php //echo $key ?><!--">-->
                            <?php foreach ($this->arrUnidades as $values): ?>
                                <option <?php if (isset($this->dataForm['idUnidade']) && $this->dataForm['idUnidade'] == $values['org_superior']) echo 'selected="selected"' ?>
                                    value="<?php echo $values['org_superior'] ?>"><?php echo $values['org_siglaautorizado'] ?> - <?php echo $values['org_nomeautorizado'] ?>
                                </option>
                            <?php endforeach; ?>
<!--                        </optgroup>-->
                </select>
                <label>Unidade</label>
            </div>
        </div>
        <div class="row">
            <div class="input-field col s12">
                <select class="invalid" required="required" name="idDestinatario" <?php if (isset($this->arrConfig['idDestinatario']) && $this->arrConfig['idDestinatario']['disabled']) echo 'disabled="disabled"' ?>>
                    <option value="" disabled selected>Selecione...</option>
                </select>
                <label>Agente</label>
            </div>
        </div>
        <div class="row">
            <div class="input-field col s12">
                <textarea required="required" name="dsMensagem"
                          class="materialize-textarea" <?php if (isset($this->arrConfig['dsMensagem']) && $this->arrConfig['dsMensagem']['disabled']) echo 'disabled="disabled"' ?>><?php if (isset($this->dataForm['dsMensagem'])) echo $this->dataForm['dsMensagem']; ?></textarea>
                <label for="textarea1" <?php if (isset($this->dataForm['dsMensagem'])) echo 'class="active"' ?>>Descricao</label>
            </div>
        </div>
        <?php if ((!isset($this->arrConfig['dsResposta']) || $this->arrConfig['dsResposta']['show'] !== false)): ?>
            <div class="row">
                <div class="input-field col s12">
                    <textarea required="required" name="dsResposta" class="materialize-textarea" <?php if (isset($this->arrConfig['dsResposta']) && $this->arrConfig['dsResposta']['disabled']) echo 'disabled="disabled"' ?>><?php if (isset($this->dataForm['dsResposta'])) echo $this->dataForm['dsResposta']; ?></textarea>
                    <label for="textarea1" <?php if (isset($this->dataForm['dsResposta'])) echo 'class="active"' ?>>Resposta</label>
                </div>
            </div>
        <?php endif; ?>
    </form>
</div>
<div class="modal-footer">
    <?php if(isset($this->isVisualizar)): ?>
        <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat light-green">Fechar</a>
    <?php else: ?>
        <a id="btn-enviar" style="margin-left: 15px;"
           class="modal-action waves-effect waves-green btn-flat light-green">Enviar</a>
        <a href="#!" class="modal-action modal-close waves-effect waves-red btn-flat">Cancelar</a>
    <?php endif; ?>
</div>
<script>
    $3(document).ready(function () {
        $3('.modal').find('select').material_select();
        setTimeout(function(){
            $3('.modal').find('[required=required]').closest('.input-field').find('input.select-dropdown').addClass('invalid');
            $3('.modal').find('[required=required]').addClass('invalid');
        }, 300);
            var select = $3('select[data-target]'),
                strUrl = select.attr('data-url'),
                objTarget = $3(select.attr('data-target'));
        ajaxRender(strUrl, objTarget, select.val(), '<?php echo (isset($this->dataForm['idDestinatario']))? $this->dataForm['idDestinatario'] :'' ?>');
    });

</script>
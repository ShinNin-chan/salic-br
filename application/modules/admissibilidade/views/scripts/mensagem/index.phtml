<nav class="breadcrumb">
    <div class="nav-wrapper" style="padding: 0 15px 0 15px">
        <div class="col s12">
            <a href="<?php echo $this->url(array('module' => 'admissibilidade', 'controller' => 'enquadramento', 'action' => 'listar'), null, true); ?>" class="breadcrumb tooltipped" data-position="top" data-delay="50" data-tooltip="Ir para a tela de enquadramento">Enquadramento</a>
            <a href="#!" class="breadcrumb tooltipped" data-position="top" data-delay="50" data-tooltip="Nome e Numero do Pronac"><?php echo $this->title ?></a>
        </div>
    </div>
</nav>
<div id="container-list" data-ajax-render='/admissibilidade/mensagem/listar?id=<?php echo (isset($this->idPronac))? $this->idPronac : ''; ?>'></div>
<?php if (isset($this->idPronac)): ?>
<div class="fixed-action-btn animated bounceInUp">
    <a href="<?php echo $this->url(array('module' => 'admissibilidade', 'controller' => 'mensagem', 'action' => 'salvar', 'idPronac' => $this->idPronac)); ?>" class="btn-floating btn-large tooltipped waves-effect waves-light" data-position="left" data-delay="50" data-tooltip="Escrever pergunta">
        <i class="large material-icons">create</i>
    </a>
</div>
<?php endif; ?>
<!--</div>-->

<script type="text/javascript">
    //    (function($){
    //        $(document).ready (function(){
    //            $('.modal').modal();
    //            $('.modal').find('select').material_select();
    //            $('body').on('#btn-enviar', 'click', function () {
    //                console.info('asd')
    ////                $.post('admissibilidade/mensagem', $('#form-mensagem').serialize());
    //            });
    //        });
    //    }($.noConflict(true)));
</script>
<script>

//    function ajaxRender(strUrl, objTarget, strVal, strValChecked) {
//        var strHtml = '';
//        $3.ajax({
//            method: "POST",
//            url: strUrl,
//            data: {id: strVal}
//        }).done(function (result) {
//            json = $3.parseJSON(result);
//            strHtml = '<option value="" disabled selected>Selecione...</option>';
//            $3.each(json, function(key, value){
//                strHtml += '<optgroup label="' + key + '">';
//                $3.each(value, function(key2, value2){
//                    if (strValChecked && strValChecked == key2) {
//                        strHtml += '<option value="' + key2 + '" selected="selected">' + value2 + '</option>';
//                    } else {
//                        strHtml += '<option value="' + key2 + '">' + value2 + '</option>';
//                    }
//                });
//                strHtml += '</optgroup>';
//            });
//            objTarget.html(strHtml);
//            objTarget.material_select();
//            objTarget.closest('.input-field').find('input.select-dropdown').addClass('invalid');
//        });
//    }

    $3(document).ready(function () {
        // the "href" attribute of .modal-trigger must specify the modal ID that wants to be triggered
        $3('body').on('click', '#btn-enviar', function () {
//            if (isValid('#form-mensagem')) {
                $3.post($3('#form-mensagem').attr('action'), $3('#form-mensagem').serialize(), function (result) {
                    result = $3.parseJSON(result);
                    if (result.status == '1') {
                        $3('#modal').modal('close');
                        $3('#form-mensagem')[0].reset();
                        $3.ajaxRender()
                        Materialize.toast(result.msg, 4000);
                        $3.each($('div[data-ajax-render]'), function () {
                            $3.ajaxRender({strUrl: $(this).attr('data-ajax-render'), strTarget: '#' + $(this).attr('id')});
                        });
                    } else {
                        if (Object.keys(result.msg).length > 1) {
                            $3.each(result.msg, function(strNameElement, strMsg){
                                var elm = $3('[name=' + strNameElement + ']'),
                                    elmLabel = elm.closest('div.input-field').find('label'),
                                    strLabel = elm.closest('div.input-field').find('label').html();
                                if (elm.length > 0) {
//                                    elmLabel.attr('data-error', 'Este campo e obrigatorio!');
//                                    elm.addClass('invalid');
                                    elm.focus();
                                    Materialize.toast('Campo ' + strLabel + ' &eacute; obrigat&oacute;rio!', 8000);
                                }
                            });
                        } else {
                            Materialize.toast(result.msg, 4000);
                        }
                    }
                });
//            }
        });

//        $3('body').on('change', 'select[data-target]', function () {
//            var select = $3(this),
//                strUrl = select.attr('data-url'),
//                objTarget = $3(select.attr('data-target'));
//            ajaxRender(strUrl, objTarget, select.val(), '');
//        });
    });
</script>